

<!DOCTYPE html>
<!--
https://www.linkedin.com/in/antoniotrento/
https://twitter.com/lantoniotrento
lantoniotrento@gmail.com
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>JBang Avatar</title>
    <meta name="description" content="Downloading gravatar images with JBang">
    <meta name="author" content="Max Rydahl Andersen">    
    <meta name="keywords" content="jbang">
    <link rel="canonical" href="https://jbang.dev"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
      <link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">
      <link href="https://unpkg.com/bootstrap-table@1.18.3/dist/extensions/group-by-v2/bootstrap-table-group-by.css" rel="stylesheet">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <!--Google Font link-->
        <link href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
 <!--Helium css-->
        <link rel="stylesheet" href="../../assets/css/animate.css">
        <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../assets/css/font-awesome.min.css">
        <link rel="stylesheet" href="../../assets/css/jasny-bootstrap.min.css">
        <link rel="stylesheet" href="../../assets/css/main.css">
        <link rel="stylesheet" href="../../assets/css/appstore.css">
        <link rel="stylesheet" href="../../assets/css/owl.carousel.css">
        <link rel="stylesheet" href="../../assets/css/owl.theme.css">
        <link rel="stylesheet" href="../../assets/css/responsive.css">
        <link rel="stylesheet" href="../../assets/css/scrolling-nav.css">	  

	<!-- CSS loaded by the children page -->
        <link rel="stylesheet" type="text/css" href="../../assets/css/custom" />

    <meta property="og:title" content="JBang Avatar">
    <meta property="og:description" content="Downloading gravatar images with JBang">
    <meta property="og:image" content="../../assets/img/big/avatar.jpg">
    <meta property="og:url" content="">
    <meta name="twitter:card" content="summary_large_image">

        <!-- hilight -->
        <link rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/rainbow.min.css"  />

  <script>hljs.initHighlightingOnLoad();</script>
	<!--[if IE]>
		<script type="text/javascript">
			 var console = { log: function() {} };
		</script>
	<![endif]-->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <!-- Google ADS mobile block-->
    
    <script type="text/javascript" async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script type="text/javascript">
     (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-9204963049240271",
        enable_page_level_ads: true
        });
    </script>
    
  
    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-156530423-2', 'auto');
	ga('send', 'pageview', { 'page': location.pathname + location.search + location.hash});
	ga('set', 'anonymizeIp', false);
    </script>
    <!-- End Google Analytics -->
    </head>
  <body>
  <div class="wrapper">	  	  
      <!--Home page style--> 
                  <!-- 
              <div class="top-menu">
              <p>
                <span class="left">
                  <a href="#"><i class="fa fa-map-marker"></i>New South Wales, Sydney</a>
                  <a href="#"><i class="fa fa-mobile-phone"></i>+9 34476 3244</a>
                  <a href="#"><i class="fa fa-envelope"></i>email@example.com</a>
              	</span>
                <span class="right hidden-sm-down">                          
                  
                  <a href="https://twitter.com/jbangdev"><i class="fa fa-twitter"></i></a>
                  
                                              
                  <a href="https://github.com/jbangdev"><i class="fa fa-github"></i></a>
                </span>
              </p>
            </div>
            -->

            <!-- navbar-default -->
            <nav class="navbar navbar-toggleable-sm navbar-light bg-default">
              <div class="container">
                <a class="navbar-brand" href="../.."><img src="../../assets/images/logo.svg" alt=""></a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar1" aria-expanded="false" aria-label="Toggle navigation">
                  <i class="fa fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse justify-content-end" id="navbar1">
                  <ul class="navbar-nav">
                    
                    
                    


  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="nav-link" href="/contribute">Contribute</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item"><a class="nav-link" href="/documentation">Documentation</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item"><a class="nav-link" href="/download">Download</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="nav-link" href="/learn">Learn</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  


 
                   </ul>
                </div>
              </div>
              <span class="right hidden-sm-down">                          
                
                <a href="https://twitter.com/jbangdev"><i class="fa fa-twitter"></i></a>
                
                                            
                <a href="https://github.com/jbangdev"><i class="fa fa-github"></i></a>
              </span>
            </nav>
  
      

<!-- Post header -->
      <div class="header-style-2">
        <div class="container">
          <div class="row">
            <div class="col-xs-12 col-sm-6">
              <div class="hero-content-v2" style="margin-top:10px!important;">
                <h3><strong>JBang Avatar</strong></h3>
                <p>
                          Downloading gravatar images with JBang
                </p>
                <a href="#post" class="page-scroll btn btn-lg btn-default-filled">Read Post</a>
                <div class="mb-60"></div>                      
              </div>
            </div>
            <div class="col-xs-12 col-sm-6">
              <figure>
                <img src="../../assets/images/avatar.jpg" alt="">
              </figure>
            </div>
          </div>
        </div>
      </div>



<!-- Post content+sidebar -->

<div class="mb-60"></div>

  <!-- Blog content + sidebar -->
  <section id="post" class="blog">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 col-md-9">
          <!-- ************************** ADS BLOCK ***************************** -->
				
                  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                  
                  <ins class="adsbygoogle"
                       style="display:block"
                       data-ad-client="ca-pub-9204963049240271"
                       data-ad-slot="2973388149"
                       data-ad-format="auto"></ins>
                  <script>
                  (adsbygoogle = window.adsbygoogle || []).push({});
                  </script>
        	
          <div class="mb-60"></div>
           <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>It is getting very close to the first anniversary of first commit of JBang.</p>
</div>
<div class="paragraph">
<p>To celebrate I looked around to see what we could do and was reminded about good old <a href="https://gource.io">Gource</a>.</p>
</div>
<div class="paragraph">
<p>With Gource you can render the history of a git repository and get a nice animated video, including flying icons for each author. Trouble is that by default they are just faceless heads - lets get some faces to all those names.</p>
</div>
<div class="paragraph">
<p>I found a <a href="https://gist.github.com/pmdgithub/706587">perl script</a> that took all committer emails and located their gravatar image; but it was Perl&#8230;&#8203;so lets make that java instead and use JBang.</p>
</div>
<div class="paragraph">
<p>The full example is available <a href="https://github.com/jbangdev/jbang/blob/master/examples/grabavatars.java">here</a>, below I&#8217;ll walk through the various interesting parts.</p>
</div>
<div class="paragraph">
<p>If you want to just directly run it do this:</p>
</div>
<div class="paragraph">
<p><code>jbang <a href="https://github.com/jbangdev/jbang/blob/master/examples/grabavatars.java" class="bare">https://github.com/jbangdev/jbang/blob/master/examples/grabavatars.java</a></code></p>
</div>
<div class="paragraph">
<p>To begin with you just get started with <code>jbang init -t cli grab-avatar</code>.</p>
</div>
<div class="paragraph">
<p>This will create a file named <code>grabavatar.java</code> with some pre-seeded code that does a Hello World! style app using picocli plus it will mark the file as executable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup-dependencies-and-main-class">Setup dependencies and main class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Then in top we are going to add a few dependencies:</p>
</div>
<div class="listingblock">
<div class="title">Dependencies</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">///usr/bin/env jbang "$0" "$@" ; exit $?
//DEPS info.picocli:picocli:4.5.0
//DEPS org.zeroturnaround:zt-exec:1.12
//DEPS commons-codec:commons-codec:1.15
//DEPS org.slf4j:slf4j-nop:1.7.30</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line is the magic "shebang" line that bash and other shells will interpret but for java it is just a comment. This is what allows you to run the script directly using <code>./grab-avatar</code></p>
</div>
<div class="paragraph">
<p>The dependencies used are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Picocli for annotation based command line parsing and help generation.</p>
</li>
<li>
<p><code>zt-exec</code> is a nice library to execute processes in a nice fluent way.</p>
</li>
<li>
<p><code>commons-coded</code> just because default Java don&#8217;t have a one-liner for MD5 hash generation.</p>
</li>
<li>
<p>No Operation slf4j to avoid the default noise slf4j generates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you run <code>./grabavatars.java</code> or <code>jbang grabavatars.java</code> these starting lines with <code>//DEPS</code> in them will be parsed and JBang fetches the dependencies to use during compilation and execution of your script.</p>
</div>
<div class="paragraph">
<p>The next is the class declaration which is mainly just annotations to define the main picocli command.</p>
</div>
<div class="listingblock">
<div class="title">class declaration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Command(name = "GrabAvatars", mixinStandardHelpOptions = true, version = "GrabAvatars 0.1",
        description = "GrabAvatars made with jbang")
class grabavatars implements Callable&lt;Integer&gt; {</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="iteration-over-execution">Iteration over execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Then the meat of the code is to run <code>git log --pretty=format:%ae|%an"</code> which will return a line for every commit with email and author, like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>max@xam.dk|Max Rydahl Andersen</code></pre>
</div>
</div>
<div class="paragraph">
<p>To do this I use <code>zt-exec</code> which has this great "one-liner" to run the process and for every line output let me process it.</p>
</div>
<div class="listingblock">
<div class="title">processing command</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        new ProcessExecutor().command("git", "log", "--pretty=format:%ae|%an")
                .redirectOutput(new LogOutputStream() {
                    @Override
                    protected void processLine(String line) {
                        String[] data = line.split("\\|");
                        String email = data[0].toLowerCase();
                        String author = data[1];</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="md5-and-download">MD5 and Download</h2>
<div class="sectionbody">
<div class="paragraph">
<p>And finally for every identified email and author - generates MD5 and download the url.</p>
</div>
<div class="listingblock">
<div class="title">processing command</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">                        URL grav_url = new URL("http://www.gravatar.com/avatar/"
                                    + DigestUtils.md5Hex(email)
                                    + "?d=404&amp;size=" + size);

                        try(InputStream in = grav_url.openStream()) {
                            Files.copy(in, authorImageFile.toPath(), StandardCopyOption.REPLACE_EXISTING);
                        }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="all-together-now">All together now</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now to run this when I have it locally is just: <code>./grab-avatars</code> in root of a git repository.</p>
</div>
<div class="paragraph">
<p>But you can also run this directly from a url using:</p>
</div>
<div class="paragraph">
<p><code>jbang <a href="https://github.com/jbangdev/jbang/blob/master/examples/grab-avatars" class="bare">https://github.com/jbangdev/jbang/blob/master/examples/grab-avatars</a></code></p>
</div>
<div class="paragraph">
<p>And then then you can go full out and render with gource - notice the <code>--user-image-dir .git/avatar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">gource --title JBang --stop-at-end --user-image-dir .git/avatar --seconds-per-day 0.05 --auto-skip-seconds 1 -1280x720 --hide filenames -o - | ffmpeg -y -r 60 -f image2pipe -vcodec ppm -i - -vcodec libx264 -preset ultrafast -pix_fmt yuv420p -crf 1 -threads 0 -bf 0 gource.mp4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you get a video which with a little bit of magic of video editing that looks something like this:</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="640" height="360" src="https://www.youtube.com/embed/da0CuVbvWLg?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>And that is about it - showed how to get started with jbang to port an existing perl script to java using a few dependencies.</p>
</div>
<div class="paragraph">
<p>See you next time!</p>
</div>
</div>
</div>
          <div class="mb-60"></div>
          <!-- ************************** ADS BLOCK ***************************** -->
				
                  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                  
                  <ins class="adsbygoogle"
                       style="display:block"
                       data-ad-client="ca-pub-9204963049240271"
                       data-ad-slot="2973388149"
                       data-ad-format="auto"></ins>
                  <script>
                  (adsbygoogle = window.adsbygoogle || []).push({});
                  </script>
        	
          <div class="mb-60"></div> 
          
                    
        </div>                    
        <div class="col-sm-12 col-md-3">
                    <!-- 
            <div class="blog-block about-sidebar-widget">
            <img src="../../assets/images">
            <h4><a href="">Max Rydahl Andersen</a></h4>
            <p></p>
                          <ul class="social-links">
                
                
                <li>
                  <a data-toggle="tooltip" href="https://twitter.com/jbangdev" title="Twitter" class="fa fa-twitter"></a>
                </li>
                
                
                
              </ul>

          </div>

          <div class="mb-60"></div>
        -->
          
        </div>
      </div>
     </div>
   </section>



	  <br />
            <!-- Footer -->
      <footer class="default-footer text-center">
        <div class="container">
          <img class="mb-40 footer-logo" src="../../assets/images/logo.svg" alt="">
          <span class="copy-right dis-blk">jbang - Unleash the power of Java with <i class="fa fa-heart cyan-color"></i> by <a href="https://xam.dk">Max Rydahl Andersen</a> and <a href="https://github.com/jbangdev/jbang/blob/master/CONTRIBUTORS.md">jbang contributors</a></span>
          <span class="social">
                  
                  <a href="https://twitter.com/jbangdev"><i class="fa fa-2x fa-twitter"></i></a>
                  
                                              
                  <a href="https://www.github.com/jbangdev/"><i class="fa fa-2x fa-github"></i></a>                            
              	
          </span>
        </div>
      </footer>

  </div>
  
  




        <!-- JS includes -->

        <script src="../../assets/js/jquery.min.js"></script>
        <script src="../../assets/js/jquery.nav.js"></script>
	<script src="../../assets/js/owl.carousel.min.js"></script>
        <script src="../../assets/js/form-validator.min.js"></script>	  
        <script src="../../assets/js/contact-form-script.js"></script>
        <script src="../../assets/js/jasny-bootstrap.min.js"></script>
        <script src="../../assets/js/jquery.mixitup.js"></script>	  
        <script src="../../assets/js/jquery.countTo.js"></script>
        <script src="../../assets/js/jquery.easing.min.js"></script>
        <script src="../../assets/js/main.js"></script>	
        <script src="../../assets/js/scrolling-nav.js"></script>
        <script src="../../assets/js/tether.min.js"></script>
        <script src="../../assets/js/bootstrap.min.js"></script>

	<!-- ********************* Grads SCRIPTING ******************************-->
	<!--Custom script loaded by children page-->
	<script src="../../assets/js"></script>


	  
  </body>
</html>

